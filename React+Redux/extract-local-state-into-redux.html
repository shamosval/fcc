<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Extract Local State into Redux
    </title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
    <script src="https://unpkg.com/redux@4.0.1/dist/redux.js"></script>
    <script src="https://unpkg.com/react-redux@7.1.0/dist/react-redux.js"></script>
    <script src="https://unpkg.com/redux-thunk@2.3.0/dist/redux-thunk.js"></script>
</head>
<body>
<div id="challenge-node"></div>
<script type="text/babel">

    // Redux:
    const ADD = 'ADD';

    const addMessage = (message) => {
        return {
            type: ADD,
            message: message
        }
    };

    const messageReducer = (state = [], action) => {
        switch (action.type) {
            case ADD:
                return [
                    ...state,
                    action.message
                ];
            default:
                return state;
        }
    };

    const store = Redux.createStore(messageReducer);

    // React:
    const Provider = ReactRedux.Provider;
    const connect = ReactRedux.connect;

    // Change code below this line
    class Presentational extends React.Component {
        constructor(props) {
            super(props);
            this.state = {
                input: ''
            }
            this.handleChange = this.handleChange.bind(this);
            this.submitMessage = this.submitMessage.bind(this);
        }
        handleChange(event) {
            this.setState({
                input: event.target.value
            });
        }
        submitMessage() {
            this.setState((state) => ({
                input: ''
            }));
            this.props.submitNewMessage(this.state.input)
        }
        render() {
            return (
                <div>
                    <h2>Type in a new Message:</h2>
                    <input
                        value={this.state.input}
                        onChange={this.handleChange}/><br/>
                    <button onClick={this.submitMessage}>Submit</button>
                    <ul>
                        {this.props.messages.map( (message, idx) => {
                            return (
                                <li key={idx}>{message}</li>
                            )
                        })
                        }
                    </ul>
                </div>
            );
        }
    };
    // Change code above this line

    const mapStateToProps = (state) => {
        return {messages: state}
    };

    const mapDispatchToProps = (dispatch) => {
        return {
            submitNewMessage: (message) => {
                dispatch(addMessage(message))
            }
        }
    };

    const Container = connect(mapStateToProps, mapDispatchToProps)(Presentational);

    class AppWrapper extends React.Component {
        render() {
            return (
                <Provider store={store}>
                    <Container/>
                </Provider>
            );
        }
    };


    ReactDOM.render(<AppWrapper />, document.getElementById('challenge-node'));


</script>
</body>
</html>

<!--
Extract Local State into Redux
You're almost done! Recall that you wrote all the Redux code so that Redux could control the state management of your React messages app. Now that Redux is connected, you need to extract the state management out of the Presentational component and into Redux. Currently, you have Redux connected, but you are handling the state locally within the Presentational component.

In the Presentational component, first, remove the messages property in the local state. These messages will be managed by Redux. Next, modify the submitMessage() method so that it dispatches submitNewMessage() from this.props, and pass in the current message input from local state as an argument. Because you removed messages from local state, remove the messages property from the call to this.setState() here as well. Finally, modify the render() method so that it maps over the messages received from props rather than state.

Once these changes are made, the app will continue to function the same, except Redux manages the state. This example also illustrates how a component may have local state: your component still tracks user input locally in its own state. You can see how Redux provides a useful state management framework on top of React. You achieved the same result using only React's local state at first, and this is usually possible with simple apps. However, as your apps become larger and more complex, so does your state management, and this is the problem Redux solves.

Run the Tests (Ctrl + Enter)
Reset this lesson
Get Help
Tests
Passed:1. The AppWrapper should render to the page.
Passed:2. The Presentational component should render to page.
Passed:3. The Presentational component should render an h2, input, button, and ul elements.
Passed:4. The Presentational component should receive messages from the Redux store as a prop.
Passed:5. The Presentational component should receive the submitMessage action creator as a prop.
Passed:6. The state of the Presentational component should contain one property, input, which is initialized to an empty string.
Passed:7. Typing in the input element should update the state of the Presentational component.
Passed:8. Dispatching the submitMessage on the Presentational component should update Redux store and clear the input in local state.
Passed:9. The Presentational component should render the messages from the Redux store.


-->